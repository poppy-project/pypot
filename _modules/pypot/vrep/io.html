

<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>pypot.vrep.io &mdash; pypot 2.0.3 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>

<link rel="stylesheet" href="../../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/my-css.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../../',
            VERSION:     '2.0.3',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="pypot 2.0.3 documentation" href="../../../index.html" />
    <link rel="up" title="pypot.vrep" href="../vrep.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../index.html">pypot 2.0.3 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../../index.html" >Module code</a></li>
              <li><a href="../vrep.html" accesskey="U">pypot.vrep</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for pypot.vrep.io</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span>

<span class="kn">from</span> <span class="nn">remoteApiBindings</span> <span class="kn">import</span> <span class="n">vrep</span> <span class="k">as</span> <span class="n">remote_api</span>
<span class="kn">from</span> <span class="nn">..robot.io</span> <span class="kn">import</span> <span class="n">AbstractIO</span>


<span class="n">vrep_error</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_ok</span><span class="p">:</span> <span class="s">&#39;Ok&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_novalue_flag</span><span class="p">:</span> <span class="s">&#39;No value&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_timeout_flag</span><span class="p">:</span> <span class="s">&#39;Timeout&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_illegal_opmode_flag</span><span class="p">:</span> <span class="s">&#39;Opmode error&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_remote_error_flag</span><span class="p">:</span> <span class="s">&#39;Remote error&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_split_progress_flag</span><span class="p">:</span> <span class="s">&#39;Progress error&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_local_error_flag</span><span class="p">:</span> <span class="s">&#39;Local error&#39;</span><span class="p">,</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_initialize_error_flag</span><span class="p">:</span> <span class="s">&#39;Init error&#39;</span>
<span class="p">}</span>

<span class="n">vrep_mode</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;normal&#39;</span><span class="p">:</span> <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_opmode_oneshot_wait</span><span class="p">,</span>
    <span class="s">&#39;streaming&#39;</span><span class="p">:</span> <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_opmode_streaming</span><span class="p">,</span>
    <span class="s">&#39;sending&#39;</span><span class="p">:</span> <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_opmode_oneshot</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="VrepIO"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO">[docs]</a><span class="k">class</span> <span class="nc">VrepIO</span><span class="p">(</span><span class="n">AbstractIO</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is used to get/set values from/to a V-REP scene.</span>

<span class="sd">        It is based on V-REP remote API (http://www.coppeliarobotics.com/helpFiles/en/remoteApiOverview.htm).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MAX_ITER</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrep_host</span><span class="o">=</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">vrep_port</span><span class="o">=</span><span class="mi">19997</span><span class="p">,</span> <span class="n">scene</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Starts the connection with the V-REP remote API server.</span>

<span class="sd">        :param str vrep_host: V-REP remote API server host</span>
<span class="sd">        :param int vrep_port: V-REP remote API server port</span>
<span class="sd">        :param str scene: path to a V-REP scene file</span>
<span class="sd">        :param bool start: whether to start the scene after loading it</span>

<span class="sd">        .. warning:: Only one connection can be established with the V-REP remote server API. So before trying to connect make sure that all previously started connections have been closed (see :func:`~pypot.vrep.io.close_all_connections`)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vrep_host</span> <span class="o">=</span> <span class="n">vrep_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrep_port</span> <span class="o">=</span> <span class="n">vrep_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>

        <span class="c"># self.client_id = remote_api.simxStart(</span>
        <span class="c">#     vrep_host, vrep_port, True, True, 5000, 5)</span>
        <span class="c"># if self.client_id == -1:</span>
        <span class="c">#     msg = (&#39;Could not connect to V-REP server on {}:{}. &#39;</span>
        <span class="c">#            &#39;This could also means that you still have &#39;</span>
        <span class="c">#            &#39;a previously opened connection running! &#39;</span>
        <span class="c">#            &#39;(try pypot.vrep.close_all_connections())&#39;)</span>
        <span class="c">#     raise VrepConnectionError(msg.format(vrep_host, vrep_port))</span>

        <span class="c"># if scene is not None:</span>
        <span class="c">#     self.load_scene(scene, start)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">open_io</span><span class="p">()</span>

<div class="viewcode-block" id="VrepIO.open_io"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.open_io">[docs]</a>    <span class="k">def</span> <span class="nf">open_io</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">remote_api</span><span class="o">.</span><span class="n">simxStart</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vrep_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrep_port</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Could not connect to V-REP server on {}:{}. &#39;</span>
                   <span class="s">&#39;This could also means that you still have &#39;</span>
                   <span class="s">&#39;a previously opened connection running! &#39;</span>
                   <span class="s">&#39;(try pypot.vrep.close_all_connections())&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VrepConnectionError</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrep_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrep_port</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_scene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.close"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Closes the current connection. &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">remote_api</span><span class="o">.</span><span class="n">simxFinish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.load_scene"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.load_scene">[docs]</a>    <span class="k">def</span> <span class="nf">load_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene_path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads a scene on the V-REP server.</span>

<span class="sd">        :param str scene_path: path to a V-REP scene file</span>
<span class="sd">        :param bool start: whether to directly start the simulation after loading the scene</span>

<span class="sd">        .. note:: It is assumed that the scene file is always available on the server side.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_simulation</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">scene_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;No such file or directory: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scene_path</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxLoadScene&#39;</span><span class="p">,</span> <span class="n">scene_path</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="VrepIO.start_simulation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.start_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">start_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Starts the simulation.</span>

<span class="sd">            .. note:: Do nothing if the simulation is already started.</span>

<span class="sd">            .. warning:: if you start the simulation just after stopping it, the simulation will likely not be started. Use :meth:`~pypot.vrep.io.VrepIO.restart_simulation` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxStartSimulation&#39;</span><span class="p">)</span>

        <span class="c"># We have to force a sleep</span>
        <span class="c"># Otherwise it may causes troubles??</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.restart_simulation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.restart_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">restart_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Re-starts the simulation. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_simulation</span><span class="p">()</span>
        <span class="c"># We have to force a sleep</span>
        <span class="c"># Otherwise the simulation is not restarted</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="VrepIO.stop_simulation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.stop_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Stops the simulation. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxStopSimulation&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.pause_simulation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.pause_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">pause_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pauses the simulation. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxPauseSimulation&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.resume_simulation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.resume_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">resume_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resumes the simulation. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="VrepIO.get_motor_position"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_motor_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_motor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the motor current position. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetJointPosition&#39;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">motor_name</span><span class="p">),</span>
                                    <span class="n">streaming</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.set_motor_position"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.set_motor_position">[docs]</a>    <span class="k">def</span> <span class="nf">set_motor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_name</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the motor target position. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxSetJointTargetPosition&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">motor_name</span><span class="p">),</span>
                             <span class="n">position</span><span class="p">,</span>
                             <span class="n">sending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.get_object_position"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_object_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">relative_to_object</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the object position. &quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">object_name</span><span class="p">)</span>
        <span class="n">relative_handle</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">relative_to_object</span> <span class="ow">is</span> <span class="bp">None</span>
                           <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">relative_to_object</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetObjectPosition&#39;</span><span class="p">,</span>
                                    <span class="n">h</span><span class="p">,</span> <span class="n">relative_handle</span><span class="p">,</span>
                                    <span class="n">streaming</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VrepIO.get_object_orientation"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_object_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">relative_to_object</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the object orientation. &quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">object_name</span><span class="p">)</span>
        <span class="n">relative_handle</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">relative_to_object</span> <span class="ow">is</span> <span class="bp">None</span>
                           <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_handle</span><span class="p">(</span><span class="n">relative_to_object</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetObjectOrientation&#39;</span><span class="p">,</span>
                                    <span class="n">h</span><span class="p">,</span> <span class="n">relative_handle</span><span class="p">,</span>
                                    <span class="n">streaming</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_object_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetObjectHandle&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<div class="viewcode-block" id="VrepIO.get_object_handle"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_object_handle">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the vrep object handle. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_object_handle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="VrepIO.get_collision_state"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_collision_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_collision_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collision_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the collision state. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxReadCollision&#39;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_collision_handle</span><span class="p">(</span><span class="n">collision_name</span><span class="p">),</span>
                                    <span class="n">streaming</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_collision_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collision</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetCollisionHandle&#39;</span><span class="p">,</span> <span class="n">collision</span><span class="p">)</span>

<div class="viewcode-block" id="VrepIO.get_collision_handle"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_collision_handle">[docs]</a>    <span class="k">def</span> <span class="nf">get_collision_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collision</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets a vrep collisions handle. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">collision</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_collision_handle</span><span class="p">(</span><span class="n">collision</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">[</span><span class="n">collision</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_handles</span><span class="p">[</span><span class="n">collision</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="VrepIO.get_simulation_current_time"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.get_simulation_current_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_simulation_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s">&#39;CurrentTime&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the simulation current time. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_remote_api</span><span class="p">(</span><span class="s">&#39;simxGetFloatSignal&#39;</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">streaming</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">VrepIOErrors</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
</div>
<div class="viewcode-block" id="VrepIO.call_remote_api"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIO.call_remote_api">[docs]</a>    <span class="k">def</span> <span class="nf">call_remote_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calls any remote API func in a thread_safe way.</span>

<span class="sd">        :param str func_name: name of the remote API func to call</span>
<span class="sd">        :param args: args to pass to the remote API call</span>
<span class="sd">        :param kwargs: args to pass to the remote API call</span>

<span class="sd">        .. note:: You can add an extra keyword to specify if you want to use the streaming or sending mode. The oneshot_wait mode is used by default (see `here &lt;http://www.coppeliarobotics.com/helpFiles/en/remoteApiConstants.htm#operationModes&gt;`_ for details about possible modes).</span>

<span class="sd">        .. warning:: You should not pass the clientId and the operationMode as arguments. They will be automatically added.</span>

<span class="sd">        As an example you can retrieve all joints name using the following call::</span>

<span class="sd">            vrep_io.remote_api_call(&#39;simxGetObjectGroupData&#39;,</span>
<span class="sd">                                    vrep_io.remote_api.sim_object_joint_type,</span>
<span class="sd">                                    0,</span>
<span class="sd">                                    streaming=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">remote_api</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_mode</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;operationMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vrep_mode</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="c"># hard_retry = True</span>

        <span class="k">if</span> <span class="s">&#39;_force&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;_force&#39;</span><span class="p">]</span>
            <span class="n">_force</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_force</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VrepIO</span><span class="o">.</span><span class="n">MAX_ITER</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_force</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;sending&#39;</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">err</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">ret</span><span class="p">,</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">err</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">res</span>

            <span class="n">err</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bool</span><span class="p">((</span><span class="n">err</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vrep_error</span><span class="p">))]</span>

            <span class="k">if</span> <span class="n">remote_api</span><span class="o">.</span><span class="n">simx_return_novalue_flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">VrepIO</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">)</span>

        <span class="c"># if any(err) and hard_retry:</span>
        <span class="c">#     print &quot;HARD RETRY&quot;</span>
        <span class="c">#     # self.stop_simulation() #nope</span>
        <span class="c">#</span>
        <span class="c">#     notconnected = True</span>
        <span class="c">#     while notconnected:</span>
        <span class="c">#         self.close()</span>
        <span class="c">#         close_all_connections()</span>
        <span class="c">#         time.sleep(0.5)</span>
        <span class="c">#         try:</span>
        <span class="c">#             self.open_io()</span>
        <span class="c">#             notconnected = False</span>
        <span class="c">#         except:</span>
        <span class="c">#             print &#39;CONNECTION ERROR&#39;</span>
        <span class="c">#             pass</span>
        <span class="c">#</span>
        <span class="c">#     self.start_simulation()</span>
        <span class="c">#</span>
        <span class="c">#     with self._lock:</span>
        <span class="c">#         ret = f(self.client_id, *args, **kwargs)</span>
        <span class="c">#</span>
        <span class="c">#         if mode == &#39;sending&#39; or isinstance(ret, int):</span>
        <span class="c">#             err, res = ret, None</span>
        <span class="c">#         else:</span>
        <span class="c">#             err, res = ret[0], ret[1:]</span>
        <span class="c">#             res = res[0] if len(res) == 1 else res</span>
        <span class="c">#</span>
        <span class="c">#         err = [bool((err &gt;&gt; i) &amp; 1) for i in range(len(vrep_error))]</span>
        <span class="c">#</span>
        <span class="c">#         return res</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">vrep_error</span><span class="p">[</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">VrepIOErrors</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span>
</div>
    <span class="k">def</span> <span class="nf">_extract_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;streaming&#39;</span><span class="p">,</span> <span class="s">&#39;sending&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">mode</span>

        <span class="k">return</span> <span class="s">&#39;normal&#39;</span>

</div>
<div class="viewcode-block" id="close_all_connections"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.close_all_connections">[docs]</a><span class="k">def</span> <span class="nf">close_all_connections</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Closes all opened connection to V-REP remote API server. &quot;&quot;&quot;</span>
    <span class="n">remote_api</span><span class="o">.</span><span class="n">simxFinish</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="c"># V-REP Errors</span></div>
<div class="viewcode-block" id="VrepIOError"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIOError">[docs]</a><span class="k">class</span> <span class="nc">VrepIOError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Base class for V-REP IO Errors. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;V-REP error code {} ({}): &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">error_code</span><span class="p">,</span> <span class="n">vrep_error</span><span class="p">[</span><span class="n">error_code</span><span class="p">],</span> <span class="n">message</span><span class="p">)</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="VrepIOErrors"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepIOErrors">[docs]</a><span class="k">class</span> <span class="nc">VrepIOErrors</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="VrepConnectionError"><a class="viewcode-back" href="../../../pypot.vrep.html#pypot.vrep.io.VrepConnectionError">[docs]</a><span class="k">class</span> <span class="nc">VrepConnectionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Base class for V-REP connection Errors. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav">
        <li><a href="../../../index.html">pypot 2.0.3 documentation</a></li>
    </ul>
    <ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../../index.html" >Module code</a></li>
        <li><a href="../vrep.html" >pypot.vrep</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2012, Poppy-Project.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3b2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>
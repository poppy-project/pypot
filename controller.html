

<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Robot Controller &mdash; PyPot 1.7.1 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>

<link rel="stylesheet" href="_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="_static/my-css.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '1.7.1',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="PyPot 1.7.1 documentation" href="index.html" />
    <link rel="up" title="Controlling robot" href="controlling_robot.html" />
    <link rel="next" title="Primitives everywhere" href="primitive.html" />
    <link rel="prev" title="Dynamixel Low-level IO" href="dynamixel.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">PyPot 1.7.1 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Robot Controller</a><ul>
<li><a class="reference internal" href="#using-the-robot-abstraction">Using the robot abstraction</a></li>
<li><a class="reference internal" href="#writing-the-configuration">Writing the configuration</a></li>
<li><a class="reference internal" href="#dynamixel-controller-and-synchronization-loop">Dynamixel controller and Synchronization Loop</a></li>
<li><a class="reference internal" href="#controlling-your-robot">Controlling your robot</a><ul>
<li><a class="reference internal" href="#controlling-in-position">Controlling in position</a></li>
<li><a class="reference internal" href="#controlling-in-speed">Controlling in speed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#closing-the-robot">Closing the robot</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="dynamixel.html" title="Dynamixel Low-level IO" accesskey="P">previous </a></li>
              <li><a href="primitive.html" title="Primitives everywhere" accesskey="N">next </a></li>
              <li><a href="py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="controlling_robot.html" accesskey="U">Controlling robot</a></li>
            
            <li class="visible-xs"><a href="_sources/controller.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Robot Controller</a><ul>
<li><a class="reference internal" href="#using-the-robot-abstraction">Using the robot abstraction</a></li>
<li><a class="reference internal" href="#writing-the-configuration">Writing the configuration</a></li>
<li><a class="reference internal" href="#dynamixel-controller-and-synchronization-loop">Dynamixel controller and Synchronization Loop</a></li>
<li><a class="reference internal" href="#controlling-your-robot">Controlling your robot</a><ul>
<li><a class="reference internal" href="#controlling-in-position">Controlling in position</a></li>
<li><a class="reference internal" href="#controlling-in-speed">Controlling in speed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#closing-the-robot">Closing the robot</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dynamixel.html"
                        title="previous chapter">Dynamixel Low-level IO</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="primitive.html"
                        title="next chapter">Primitives everywhere</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/controller.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="robot-controller">
<span id="controller"></span><h1>Robot Controller<a class="headerlink" href="#robot-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-the-robot-abstraction">
<h2>Using the robot abstraction<a class="headerlink" href="#using-the-robot-abstraction" title="Permalink to this headline">¶</a></h2>
<p>While the <a class="reference internal" href="dynamixel.html#low-level"><em>Dynamixel Low-level IO</em></a> provides access to all functionalities of the dynamixel motors, it forces you to have synchronous calls which can take a non-negligible amount of time. In particular, most programs will need to have a really fast read/write synchronization loop, where we typically read all motor position, speed, load and set new values, while in parallel we would like to have higher level code that computes those new values. This is pretty much what the robot abstraction is doing for you. More precisely, through the use of the class <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> you can:</p>
<ul class="simple">
<li>automatically initialize all connections (make transparent the use of multiple USB2serial connections),</li>
<li>define <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.offset" title="pypot.dynamixel.motor.DxlMotor.offset"><code class="xref py py-attr docutils literal"><span class="pre">offset</span></code></a> and <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.direct" title="pypot.dynamixel.motor.DxlMotor.direct"><code class="xref py py-attr docutils literal"><span class="pre">direct</span></code></a> attributes   for motors,</li>
<li>automatically define accessor for motors and their most frequently used registers (such as <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_position" title="pypot.dynamixel.motor.DxlMotor.goal_position"><code class="xref py py-attr docutils literal"><span class="pre">goal_position</span></code></a>, <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.present_speed" title="pypot.dynamixel.motor.DxlMotor.present_speed"><code class="xref py py-attr docutils literal"><span class="pre">present_speed</span></code></a>, <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.present_load" title="pypot.dynamixel.motor.DxlMotor.present_load"><code class="xref py py-attr docutils literal"><span class="pre">present_load</span></code></a>, <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMXMotor.pid" title="pypot.dynamixel.motor.DxlMXMotor.pid"><code class="xref py py-attr docutils literal"><span class="pre">pid</span></code></a>, <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.compliant" title="pypot.dynamixel.motor.DxlMotor.compliant"><code class="xref py py-attr docutils literal"><span class="pre">compliant</span></code></a>),</li>
<li>define read/write synchronization loop that will run in background.</li>
</ul>
<p>We will first see how to define your robot thanks to the writing of a <a class="reference internal" href="#config-file"><em>configuration</em></a>, then we will describe how to set up <a class="reference internal" href="#sync-loop"><em>synchronization loops</em></a>. Finally, we will show how to easily <a class="reference internal" href="#control-robot"><em>control this robot through asynchronous commands</em></a>.</p>
</div>
<div class="section" id="writing-the-configuration">
<span id="config-file"></span><h2>Writing the configuration<a class="headerlink" href="#writing-the-configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration, described as a Python dictionary, contains several important features that help build both your robot and the software to manage you robot. The important fields are listed below:</p>
<ul class="simple">
<li><strong>controllers</strong> - This key holds the information pertaining to a controller and all the items connected to its bus.</li>
<li><strong>motors</strong> - This is a description of all the custom setup values for each motor. Meta information, such as the motor access name or orientation, is also included here. It is also there that you will set the angle limits of the motor.</li>
<li><strong>motorgroups</strong> - This is used to define alias of a group of motors (e.g. left_leg).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The configuration can be written programmatically or can be loaded from any file that can be loaded as a dict (e.g. a JSON file).</p>
</div>
<p>Now let&#8217;s detail each section. To better understand how the configuration is structure it is probably easier to start from one of the example provided with PyPot and modify it (e.g. <code class="xref py py-obj docutils literal"><span class="pre">pypot.robot.config.ergo_robot_config</span></code>):</p>
<ol class="arabic">
<li><p class="first"><strong>controllers</strong>: You can have a single or multiple <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a>. For each of them, you should indicate whether or not to use the SYNC_READ instruction (only the USB2AX device currently supported it). When you describe your controller, you must also include the port that the device is connected to (see <a class="reference internal" href="dynamixel.html#open-connection"><em>Opening/Closing a communication port</em></a>). You also have to specify which motors are attached to this bus. You can either give individual motors or groups (see the sections below):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_config</span><span class="p">[</span><span class="s">&#39;controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_config</span><span class="p">[</span><span class="s">&#39;controllers&#39;</span><span class="p">][</span><span class="s">&#39;upper_body_controler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="s">&#39;/dev/ttyUSB0&#39;</span><span class="p">,</span>
    <span class="s">&#39;sync_read&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;attached_motors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;torso&#39;</span><span class="p">,</span> <span class="s">&#39;head&#39;</span><span class="p">,</span> <span class="s">&#39;arms&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>motorgroups</strong>: Here, you can define the different motors group corresponding to the structure of your robot. It will automatically create an alias for the group. Groups can be nested, i.e. a group can be included inside another group, as in the example below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_config</span><span class="p">[</span><span class="s">&#39;motorgroups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;torso&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;arms&#39;</span><span class="p">,</span> <span class="s">&#39;head_x&#39;</span><span class="p">,</span> <span class="s">&#39;head_y&#39;</span><span class="p">],</span>
    <span class="s">&#39;arms&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;left_arm&#39;</span><span class="p">,</span> <span class="s">&#39;right_arm&#39;</span><span class="p">],</span>
    <span class="s">&#39;left_arm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;l_shoulder_x&#39;</span><span class="p">,</span> <span class="s">&#39;l_shoulder_y&#39;</span><span class="p">,</span> <span class="s">&#39;l_elbow&#39;</span><span class="p">],</span>
    <span class="s">&#39;right_arm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;r_shoulder_x&#39;</span><span class="p">,</span> <span class="s">&#39;r_shoulder_y&#39;</span><span class="p">,</span> <span class="s">&#39;r_elbow&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>motors</strong>: Then, you add all the motors. The attributes are not optional and describe how the motors can be used in the software. You have to specify the type of motor, it will change which attributes are available (e.g. compliance margin versus pid gains). The name and id are used to access the motor specifically. Orientation describes whether the motor will act in an anti-clockwise fashion (direct) or clockwise (indirect). You should also provide the angle limits of your motor. They will be checked automatically at every start up and changed if needed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_config</span><span class="p">[</span><span class="s">&#39;motors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_config</span><span class="p">[</span><span class="s">&#39;motors&#39;</span><span class="p">][</span><span class="s">&#39;l_hip_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-64&#39;</span><span class="p">,</span>
    <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span>
    <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">22.5</span><span class="p">,</span>
    <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">112.5</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">This is all you need to create and interact with your robot. All that remains is to connect your robot to your computer. To create your robot use the <a class="reference internal" href="pypot.robot.html#pypot.robot.config.from_config" title="pypot.robot.config.from_config"><code class="xref py py-func docutils literal"><span class="pre">from_config()</span></code></a> function which takes your configuration as an argument. Here is an example of how to create your first robot and start using it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pypot.robot</span>

<span class="n">robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">my_config</span><span class="p">)</span>
<span class="n">robot</span><span class="o">.</span><span class="n">start_sync</span><span class="p">()</span>

<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">left_arm</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">m</span><span class="o">.</span><span class="n">present_position</span>
</pre></div>
</div>
</li>
<li><p class="first">(optional) If you prefer working with file, you can read/write your config to any format that can be transformed into a dictionary. For instance, you can easily use the JSON format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">pypot.robot</span>

<span class="kn">from</span> <span class="nn">pypot.robot.config</span> <span class="kn">import</span> <span class="n">ergo_robot_config</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ergo.json&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ergo_robot_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ergo</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s">&#39;ergo.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>To give you a complete overview of what your config should look like, here is the listing of the Ergo-Robot config dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ergo_robot_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;controllers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;my_dxl_controller&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="s">&#39;/dev/ttyUSB0&#39;</span><span class="p">,</span> <span class="c"># Depends on your OS</span>
            <span class="s">&#39;sync_read&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;attached_motors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;base&#39;</span><span class="p">,</span> <span class="s">&#39;head&#39;</span><span class="p">],</span> <span class="c"># You can mix motorgroups or individual motors</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="s">&#39;motorgroups&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;base&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;base_pan&#39;</span><span class="p">,</span> <span class="s">&#39;base_tilt_lower&#39;</span><span class="p">,</span> <span class="s">&#39;base_tilt_upper&#39;</span><span class="p">],</span>
        <span class="s">&#39;head&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;head_pan&#39;</span><span class="p">,</span> <span class="s">&#39;head_tilt_lower&#39;</span><span class="p">,</span> <span class="s">&#39;head_tilt_upper&#39;</span><span class="p">],</span>
    <span class="p">},</span>

    <span class="s">&#39;motors&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;base_pan&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-64&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">22.5</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">112.5</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s">&#39;base_tilt_lower&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-64&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s">&#39;base_tilt_upper&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-64&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s">&#39;head_pan&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-28&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;direct&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">22.5</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">112.5</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s">&#39;head_tilt_lower&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-28&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;indirect&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s">&#39;head_tilt_upper&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;RX-28&#39;</span><span class="p">,</span>
            <span class="s">&#39;orientation&#39;</span><span class="p">:</span> <span class="s">&#39;indirect&#39;</span><span class="p">,</span>
            <span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s">&#39;angle_limit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since Pypot 1.7, you can now set the port to &#8216;auto&#8217; in the dictionary. When loading the configuration, Pypot will automatically try to find the port with the corresponding attached motor ids.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While this is convenient as the same config file can be use on multiple machine, it also slows the creation of the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a>.</p>
</div>
</div>
<div class="section" id="dynamixel-controller-and-synchronization-loop">
<span id="sync-loop"></span><h2>Dynamixel controller and Synchronization Loop<a class="headerlink" href="#dynamixel-controller-and-synchronization-loop" title="Permalink to this headline">¶</a></h2>
<p>As indicated above, the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> held instances of <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a>. Each of this instance represents a real motor of your physical robot. The attributes of those &#8220;software&#8221; motors are automatically synchronized with the real &#8220;hardware&#8221; motors. In order to do that, the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> class uses a <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a> which defines synchronization loops that will read/write the registers of dynamixel motors at a predefined frequency.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The synchronization loops will try to run at the defined frequency, however don&#8217;t forget that you are limited by the bus bandwidth! For instance, depending on your robot you will not be able to read/write the position of all motors at 100Hz. Moreover, the loops are implemented as python thread and we can thus not guarantee the exact frequency of the loop.</p>
</div>
<p>If you looked closely at the example above, you could have noticed that even without defining any controller nor synchronization loop, you can already read the present position of the motors. Indeed, by default the class <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> uses a particular controller <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.BaseDxlController" title="pypot.dynamixel.controller.BaseDxlController"><code class="xref py py-class docutils literal"><span class="pre">BaseDxlController</span></code></a> which already defines synchronization loops. More precisely, this controller:</p>
<ul class="simple">
<li>reads the present position, speed, load at 50Hz,</li>
<li>writes the goal position, moving speed and torque limit at 50Hz,</li>
<li>writes the pid or compliance margin/slope (depending on the type of motor) at 10Hz,</li>
<li>reads the present temperature and voltage at 1Hz.</li>
</ul>
<p>So, in most case you should not have to worry about synchronization loop and it should directly work. Off course, if you want to synchronize other values than the ones listed above you will have to modify this default behavior.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With the current version of PyPot, you can not indicate in the configuration which subclasses of <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a> you want to use. This feature should be added in a future version. If you want to use your own controller, you should either modify the config parser, modify the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.BaseDxlController" title="pypot.dynamixel.controller.BaseDxlController"><code class="xref py py-class docutils literal"><span class="pre">BaseDxlController</span></code></a> class or directly instantiate the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> class.</p>
</div>
<p>To start all the synchronization loops, you only need to call the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot.start_sync" title="pypot.robot.robot.Robot.start_sync"><code class="xref py py-meth docutils literal"><span class="pre">start_sync()</span></code></a> method. You can also stop the synchronization if needed (see the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot.stop_sync" title="pypot.robot.robot.Robot.stop_sync"><code class="xref py py-meth docutils literal"><span class="pre">stop_sync()</span></code></a> method):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pypot.robot</span>

<span class="n">robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">my_config</span><span class="p">)</span>
<span class="n">robot</span><span class="o">.</span><span class="n">start_sync</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should never set values to motors before starting the synchronization loop.</p>
</div>
<p>Now you have a robot that is reading and writing values to each motor in an infinite loop. Whenever you access these values, you are accessing only their most recent versions that have been read at the frequency of the loop. This automatically make the synchronization loop run in background. You do not need to wait the answer of a read command to access data (this can take some time) so that algorithms with heavy computation do not encounter a bottleneck when values from motors must be known.</p>
<p>Now you are ready to create some behaviors for your robot.</p>
</div>
<div class="section" id="controlling-your-robot">
<span id="control-robot"></span><h2>Controlling your robot<a class="headerlink" href="#controlling-your-robot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="controlling-in-position">
<h3>Controlling in position<a class="headerlink" href="#controlling-in-position" title="Permalink to this headline">¶</a></h3>
<p>As shown in the examples above, the robot class let you directly access the different motors. For instance, let&#8217;s assume we are working with an Ergo-robot, you could then write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pypot.robot</span>

<span class="kn">from</span> <span class="nn">pypot.robot.config</span> <span class="kn">import</span> <span class="n">ergo_robot_config</span>

<span class="n">robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">ergo_robot_config</span><span class="p">)</span>
<span class="n">ergo_start_sync</span><span class="p">()</span>

<span class="c"># Note that all these calls will return immediately,</span>
<span class="c"># and the orders will not be directly sent</span>
<span class="c"># (they will be sent during the next write loop iteration).</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ergo_robot</span><span class="o">.</span><span class="n">base</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">compliant</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">m</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c"># This will return the last synchronized value</span>
<span class="k">print</span> <span class="n">ergo_robot</span><span class="o">.</span><span class="n">base_pan</span><span class="o">.</span><span class="n">present_position</span>
</pre></div>
</div>
<p>For a complete list of all the attributes that you can access, you should refer to the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a> API.</p>
<p>As an example of what you can easily do with the Robot API, we are going to write a simple program that will make a robot with two motors move with sinusoidal motions. More precisely, we will apply a sinusoid to one motor and the other one will read the value of the first motor and use it as its own goal position. We will still use an Ergo-robot as example:</p>
<div class="highlight-python"><div class="highlight"><pre>import time
import numpy

import pypot.robot

from pypot.robot.config import ergo_robot_config

amp = 30
freq = 0.5

robot = pypot.robot.from_config(ergo_robot_config)    ergo_robot.start_sync()

# Put the robot in its initial position
for m in ergo_robot.motors: # Note that we always provide an alias for all motors.
    m.compliant = False
    m.goal_position = 0

# Wait for the robot to actually reach the base position.
time.sleep(2)

# Do the sinusoidal motions for 10 seconds
t0 = time.time()

while True:
    t = time.time() - t0

    if t &gt; 10:
        break

    pos = amp * numpy.sin(2 * numpy.pi * freq * t)

    ergo_robot.base_pan.goal_position = pos

    # In order to make the other sinus more visible,
    # we apply it with an opposite phase and we increase the amplitude.
    ergo_robot.head_pan.goal_position = -1.5 * ergo_robot.base_pan.present_position

    # We want to run this loop at 50Hz.
    time.sleep(0.02)
</pre></div>
</div>
</div>
<div class="section" id="controlling-in-speed">
<h3>Controlling in speed<a class="headerlink" href="#controlling-in-speed" title="Permalink to this headline">¶</a></h3>
<p>Thanks to the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_speed" title="pypot.dynamixel.motor.DxlMotor.goal_speed"><code class="xref py py-attr docutils literal"><span class="pre">goal_speed</span></code></a> property you can also control your robot in speed. More precisely, by setting <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_speed" title="pypot.dynamixel.motor.DxlMotor.goal_speed"><code class="xref py py-attr docutils literal"><span class="pre">goal_speed</span></code></a> you will change the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.moving_speed" title="pypot.dynamixel.motor.DxlMotor.moving_speed"><code class="xref py py-attr docutils literal"><span class="pre">moving_speed</span></code></a> of your motor but you will also automatically change the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_position" title="pypot.dynamixel.motor.DxlMotor.goal_position"><code class="xref py py-attr docutils literal"><span class="pre">goal_position</span></code></a> that will be set to the angle limit in the desired direction.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You could also use the wheel mode settings where you can directly change the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.moving_speed" title="pypot.dynamixel.motor.DxlMotor.moving_speed"><code class="xref py py-attr docutils literal"><span class="pre">moving_speed</span></code></a>. Nevertheless, while the motor will turn infinitely with the wheel mode, here with the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_speed" title="pypot.dynamixel.motor.DxlMotor.goal_speed"><code class="xref py py-attr docutils literal"><span class="pre">goal_speed</span></code></a> the motor will still respect the angle limits.</p>
</div>
<p>As an example, you could write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">speeds</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">speeds</span><span class="p">:</span>
    <span class="n">ergo_robot</span><span class="o">.</span><span class="n">head_pan</span><span class="o">.</span><span class="n">goal_speed</span> <span class="o">=</span> <span class="n">s</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ergo_robot</span><span class="o">.</span><span class="n">head_pan</span><span class="o">.</span><span class="n">present_position</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c"># By applying a cosinus on the speed</span>
<span class="c"># You observe a sinusoid on the position</span>
<span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you set both <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_speed" title="pypot.dynamixel.motor.DxlMotor.goal_speed"><code class="xref py py-attr docutils literal"><span class="pre">goal_speed</span></code></a> and <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor.goal_position" title="pypot.dynamixel.motor.DxlMotor.goal_position"><code class="xref py py-attr docutils literal"><span class="pre">goal_position</span></code></a> only the last command will be executed. Unless you know what you are doing, you should avoid to mix these both approaches.</p>
</div>
</div>
</div>
<div class="section" id="closing-the-robot">
<h2>Closing the robot<a class="headerlink" href="#closing-the-robot" title="Permalink to this headline">¶</a></h2>
<p>To make sure that everything gets cleaned correctly after you are done using your <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a>, you should always call the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot.close" title="pypot.robot.robot.Robot.close"><code class="xref py py-meth docutils literal"><span class="pre">close()</span></code></a> method. Doing so will ensure that all the controllers attached to this robot, and their associated dynamixel serial connection, are correctly stopped and cleaned.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note calling the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot.close" title="pypot.robot.robot.Robot.close"><code class="xref py py-meth docutils literal"><span class="pre">close()</span></code></a> method on a <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> can prevent you from opening it again without terminating your current Python session. Indeed, as the destruction of object is handled by the garbage collector, there is no mechanism which guarantee that we can automatically clean it when destroyed.</p>
</div>
<p>When closing the robot, we also send a stop signal to all the primitives running and wait for them to terminate. See section <a class="reference internal" href="primitive.html#my-prim"><em>Primitives everywhere</em></a> for details on what we call primitives.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should be careful that all your primitives correctly respond to the stop signal. Indeed, having a blocking primitive will prevent the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot.close" title="pypot.robot.robot.Robot.close"><code class="xref py py-meth docutils literal"><span class="pre">close()</span></code></a> method to terminate (please refer to <a class="reference internal" href="primitive.html#start-prim"><em>Start, Stop, Pause, and Resume</em></a> for details).</p>
</div>
<p>Thanks to the <a class="reference external" href="http://docs.python.org/library/contextlib.html#contextlib.closing" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">contextlib.closing()</span></code></a> decorator you can easily make sure that the close function of your robot is always called whatever happened inside your code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">closing</span>

<span class="kn">import</span> <span class="nn">pypot.robot</span>

<span class="c"># The closing decorator make sure that the close function will be called</span>
<span class="c"># on the object passed as argument when the with block is exited.</span>
<span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s">&#39;myconfig.json&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">my_robot</span><span class="p">:</span>
    <span class="n">my_robot</span><span class="o">.</span><span class="n">start_sync</span><span class="p">()</span>

    <span class="c"># do stuff without having to make sure not to forget to close my_robot!</span>
</pre></div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav">
        <li><a href="index.html">PyPot 1.7.1 documentation</a></li>
    </ul>
    <ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="dynamixel.html" title="Dynamixel Low-level IO" >previous</a></li>
        <li><a href="primitive.html" title="Primitives everywhere" >next</a></li>
        <li><a href="py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="controlling_robot.html" >Controlling robot</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2012, Pierre Rouanet, Matthieu Lapeyre, Haylee Fogg.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3b1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>
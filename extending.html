

<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Extending pypot &mdash; pypot 2.11.2 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="_static/my-css.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '2.11.2',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="_static/pypot_logo-48x48.png"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="pypot 2.11.2 documentation" href="index.html" />
    <link rel="next" title="REST API" href="remote_access.html" />
    <link rel="prev" title="Using a simulated robot with V-REP" href="vrep.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">pypot 2.11.2 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Extending pypot</a><ul>
<li><a class="reference internal" href="#pypot-s-architecture">Pypot&#8217;s architecture</a></li>
<li><a class="reference internal" href="#adding-another-layer">Adding another layer</a><ul>
<li><a class="reference internal" href="#writing-a-new-io">Writing a new IO</a></li>
<li><a class="reference internal" href="#writing-a-new-controller">Writing a new Controller</a></li>
<li><a class="reference internal" href="#integrates-it-into-the-robot">Integrates it into the Robot</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="vrep.html" title="Using a simulated robot with V-REP" accesskey="P">previous </a></li>
              <li><a href="remote_access.html" title="REST API" accesskey="N">next </a></li>
              <li><a href="py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="genindex.html" title="General Index" accesskey="I">index </a></li>
            
            <li class="visible-xs"><a href="_sources/extending.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="index.html">
      <img class="logo" src="_static/pypot_logo-144x144.png" alt="Logo"/>
    </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending pypot</a><ul>
<li><a class="reference internal" href="#pypot-s-architecture">Pypot&#8217;s architecture</a></li>
<li><a class="reference internal" href="#adding-another-layer">Adding another layer</a><ul>
<li><a class="reference internal" href="#writing-a-new-io">Writing a new IO</a></li>
<li><a class="reference internal" href="#writing-a-new-controller">Writing a new Controller</a></li>
<li><a class="reference internal" href="#integrates-it-into-the-robot">Integrates it into the Robot</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vrep.html"
                        title="previous chapter">Using a simulated robot with V-REP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="remote_access.html"
                        title="next chapter">REST API</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/extending.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="extending-pypot">
<span id="extending"></span><h1>Extending pypot<a class="headerlink" href="#extending-pypot" title="Permalink to this headline">¶</a></h1>
<p>While pypot has been originally designed for controlling dynamixel based robots, it became rapidly obvious that it would be really useful to easily:</p>
<ul class="simple">
<li>control other types of motor (e.g. servo-motors controlled using PWM)</li>
<li>control an entire robot composed of different types of motors (using dynamixel for the legs and smaller servo for the hands for instance)</li>
</ul>
<p>While it was already possible to do such things in pypot, the library has been partially re-architectured in version 2.x to better reflect those possibilities and most importantly make it easier for contributors to add the layer needed for adding support for other types of motors.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While in most of this documentation, we will show how support for other motors can be added, similar methods can be applied to also support other sensors.</p>
</div>
<p>The rest of this section will describe the main concept behing pypot&#8217;s architecture and then give examples of how to extend it.</p>
<div class="section" id="pypot-s-architecture">
<h2>Pypot&#8217;s architecture<a class="headerlink" href="#pypot-s-architecture" title="Permalink to this headline">¶</a></h2>
<p>Pypot&#8217;s architecture is built upon the following basic concepts:</p>
<ul class="simple">
<li><strong>I/O</strong>: low-level layer handling the communication with motors or sensors. This abstract layer has been designed to be as generic as possible. The idea is to keep each specific communication protocol separated from the rest of the architecture and allow for an easy replacement of an IO by another one - such an example is detailed in the next section when <a class="reference external" href="http://poppy-project.github.io/pypot/pypot.dynamixel.html#module-pypot.dynamixel.io">dynamixel IO</a> is replaced by the <a class="reference external" href="http://poppy-project.github.io/pypot/pypot.vrep.html#module-pypot.vrep.io">communication layout with the VREP</a> simulator.</li>
<li><strong>Controller</strong>: set of update loops to keep an (or multiple) &#8220;hardware&#8221; device(s) up to date with their &#8220;software&#8221; equivalent. This synchronization can goes only from the hard to the soft (e.g. in the case of a sensor) or both ways (e.g. for reading motor values and sending motor commands). The calls can be asynchronous or synchronous, each controller can have its own refresh frequency. An example of <code class="xref py py-class docutils literal"><span class="pre">Controller</span></code> is the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a> which synchronizes position/speed/load of all motors on a dynamixel bus in both directions.</li>
<li><strong>Robot</strong>: The robot layer is a pure abstraction which aims at bringing together different types of motors and sensors. This high-level is most likely to be the one accessed by the end-user which wants to directly control the motors of its robot no matter what is the IO used underneath. The robot can be directly created using a <a class="reference external" href="http://poppy-project.github.io/pypot/controller.html#writing-the-configuration">configuration file</a> describing all IO and Controllers used.</li>
<li><strong>Primitive</strong>: independent behaviors applied to a robot. They are not directly accessing the robot registers but are first combined through a <a class="reference external" href="http://poppy-project.github.io/pypot/primitive.html">Primitive Manager</a> which sends the results of this combination to the robot. This abstraction is used to designed behavioral-unit that can be combined into more complex behaviors (e.g. a walking primitive and and balance primitive combined to obtain a balanced-walking). Primitives are also a convenient way to monitor or remotely access a robot - ensuring some sort of sandboxing.</li>
</ul>
<p>Those main aspects of pypot&#8217;s architecture are summarized in the figure below.</p>
<a class="reference internal image-reference" href="_images/pypot-archi.jpg"><img alt="_images/pypot-archi.jpg" class="align-center" src="_images/pypot-archi.jpg" style="width: 60%;" /></a>
</div>
<div class="section" id="adding-another-layer">
<h2>Adding another layer<a class="headerlink" href="#adding-another-layer" title="Permalink to this headline">¶</a></h2>
<p>If you want to add support for the brand new servo-motors in pypot or the new mindblowing sensor, you are in the right section. As an example of how you should proceed, we will describe how support for the <a class="reference external" href="http://www.coppeliarobotics.com">V-REP simulator</a> was added and how it allows for a seamless switch from real to simulated robot.</p>
<p>Adding support for the V-REP simulator in pypot could be sum up in three main steps:</p>
<ul class="simple">
<li>Writing the low-level IO for V-REP.</li>
<li>Writing the controller to synchronize pypot&#8217;s <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> with the V-REP&#8217;s one.</li>
<li>Integrates it to a <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a></li>
</ul>
<div class="section" id="writing-a-new-io">
<h3>Writing a new IO<a class="headerlink" href="#writing-a-new-io" title="Permalink to this headline">¶</a></h3>
<p>In pypot&#8217;s architecture, the IO aims at providing convenient methods to access (read/write) value from a device - which could be a motor, a camera, or a simulator. It is the role of the IO to handle the communication:</p>
<ul class="simple">
<li>open/close the communication channel,</li>
<li>encapsulate the protocol.</li>
</ul>
<p>For example, the <code class="xref py py-class docutils literal"><span class="pre">DxlIO</span></code> (for dynamixel buses) open/closes the serial port and provides high-level methods for sending dynamixel packet - e.g. for getting a motor position. Similarly, writing the <a class="reference internal" href="pypot.vrep.html#pypot.vrep.io.VrepIO" title="pypot.vrep.io.VrepIO"><code class="xref py py-class docutils literal"><span class="pre">VrepIO</span></code></a> consists in opening the communication socket to the V-REP simulator (thanks to <a class="reference external" href="http://www.coppeliarobotics.com/helpFiles/en/remoteApiFunctionsPython.htm">V-REP&#8217;s remote API</a>) and then encapsulating all methods for getting/setting all the simulated motors registers.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">While this is not by any mean mandatory, it is often a good practice to write all IO access as synchronous calls. The higher-level synchronization loop is usually written as a <a class="reference internal" href="pypot.robot.html#pypot.robot.controller.AbstractController" title="pypot.robot.controller.AbstractController"><code class="xref py py-class docutils literal"><span class="pre">AbstractController</span></code></a>.</p>
</div>
<p>The IO should also handle the low-level communication errors. For instance, the <code class="xref py py-class docutils literal"><span class="pre">DxlIO</span></code> automatically handles the timeout error to prevent the whole communication to stop.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once the new IO is written most of the integration into pypot should be done! To facilitate the integration of the new IO with the higher layer, we strongly recommend to take inspiration from the existing IO - especially the <code class="xref py py-class docutils literal"><span class="pre">DxlIO</span></code> and the <a class="reference internal" href="pypot.vrep.html#pypot.vrep.io.VrepIO" title="pypot.vrep.io.VrepIO"><code class="xref py py-class docutils literal"><span class="pre">VrepIO</span></code></a> ones.</p>
</div>
</div>
<div class="section" id="writing-a-new-controller">
<h3>Writing a new Controller<a class="headerlink" href="#writing-a-new-controller" title="Permalink to this headline">¶</a></h3>
<p>A <code class="xref py py-class docutils literal"><span class="pre">Controller</span></code> is basically a synchronization loop which role is to keep up to date the state of the device and its &#8220;software&#8221; equivalent - through the associated IO.</p>
<p>In the case of the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a>, it runs a 50Hz loop which reads the actual position/speed/load of the real motor and sets it to the associated register in the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a>. It also reads the goal position/speed/load set in the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a> and sends them to the &#8220;real&#8221; motor.</p>
<p>As most controller will have the same general structure - i.e. calling a sync. method at a predefined frequency - pypot provides an abstract class, the <a class="reference internal" href="pypot.robot.html#pypot.robot.controller.AbstractController" title="pypot.robot.controller.AbstractController"><code class="xref py py-class docutils literal"><span class="pre">AbstractController</span></code></a>, which does exactly that. If your controller fits within this conception, you should only have to overide the <code class="xref py py-meth docutils literal"><span class="pre">update()</span></code> method.</p>
<p>In the case of the <a class="reference internal" href="pypot.vrep.html#pypot.vrep.controller.VrepController" title="pypot.vrep.controller.VrepController"><code class="xref py py-class docutils literal"><span class="pre">VrepController</span></code></a>, the update loop simply retrieves each motor&#8217;s present position and send the new target position. A similar approach is used to retrieve values form V-REP sensors.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each controller can run at its own pre-defined frequency and live within its own thread. Thus, the update never blocks the main thread and you can used tight synchronization loop where they are needed (e.g. for motor&#8217;s command) and slower one when latency is not a big issue (e.g. a temperature sensor).</p>
</div>
</div>
<div class="section" id="integrates-it-into-the-robot">
<h3>Integrates it into the Robot<a class="headerlink" href="#integrates-it-into-the-robot" title="Permalink to this headline">¶</a></h3>
<p>Once you have defined your Controller, you most likely want to define a convenient factory functions (such as <a class="reference internal" href="pypot.robot.html#pypot.robot.config.from_config" title="pypot.robot.config.from_config"><code class="xref py py-func docutils literal"><span class="pre">from_config()</span></code></a> or <a class="reference internal" href="pypot.vrep.html#pypot.vrep.from_vrep" title="pypot.vrep.from_vrep"><code class="xref py py-func docutils literal"><span class="pre">from_vrep()</span></code></a>) allowing users to easily instantiate their <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> with the new Controller.</p>
<p>By doing so you will permit them to seamlessly uses your interface with this new device without changing the high-level API. For instance, as both the <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController" title="pypot.dynamixel.controller.DxlController"><code class="xref py py-class docutils literal"><span class="pre">DxlController</span></code></a> and the <a class="reference internal" href="pypot.vrep.html#pypot.vrep.controller.VrepController" title="pypot.vrep.controller.VrepController"><code class="xref py py-class docutils literal"><span class="pre">VrepController</span></code></a> only interact with the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> through getting and setting values into <a class="reference internal" href="pypot.robot.html#pypot.robot.motor.Motor" title="pypot.robot.motor.Motor"><code class="xref py py-class docutils literal"><span class="pre">Motor</span></code></a> instances, they can be directly switch.</p>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="index.html">pypot 2.11.2 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="vrep.html" title="Using a simulated robot with V-REP" >previous</a></li>
        <li><a href="remote_access.html" title="REST API" >next</a></li>
        <li><a href="py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2015, Poppy-Project.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>